{"version":3,"file":"dialog.js","sourceRoot":"","sources":["../../../src/lib/dialog/dialog.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EACL,SAAS,EACT,MAAM,EACN,KAAK,EACL,YAAY,EACZ,QAAQ,EACR,QAAQ,EACR,SAAS,EACT,iBAAiB,EAEjB,SAAS,EACT,gBAAgB,EAChB,WAAW,GACZ,MAAM,eAAe,CAAC;AACvB,OAAO,EACL,KAAK,EACL,OAAO,EACP,KAAK,EACL,UAAU,EACV,OAAO,GACR,MAAM,qBAAqB,CAAC;AAC7B,OAAO,EACL,MAAM,EACN,OAAO,EACP,YAAY,EAEZ,uBAAuB,EACxB,MAAM,cAAc,CAAC;AACtB,OAAO,EAAE,YAAY,EAAE,MAAM,4BAA4B,CAAC;AAE1D,OAAO,yBAAyB,CAAC;AAKjC;IAAA;QACE,SAAI,GAAgB,QAAQ,CAAC;QAC7B,iBAAY,GAAa,KAAK,CAAC;IACjC,CAAC;IAAD,sBAAC;AAAD,CAAC,AAHD,IAGC;;AAGD,IAAa,eAAe;IAAS,mCAAuB;IAC1D,yBAAY,WAA6B,EAAE,gBAAkC;eAC3E,kBAAM,WAAW,EAAE,gBAAgB,CAAC;IACtC,CAAC;IACH,sBAAC;AAAD,CAAC,AAJD,CAAqC,uBAAuB,GAI3D;AAJY,eAAe;IAD3B,SAAS,CAAC,EAAE,QAAQ,EAAE,mBAAmB,EAAE,CAAC;qCAElB,WAAW,EAAyB,gBAAgB;GADlE,eAAe,CAI3B;SAJY,eAAe;AAM5B;;GAEG;AAEH,IAAa,cAAc;IAA3B;IAA8B,CAAC;IAAD,qBAAC;AAAD,CAAC,AAA/B,IAA+B;AAAlB,cAAc;IAD1B,SAAS,CAAC,EAAE,QAAQ,EAAE,kBAAkB,EAAE,CAAC;GAC/B,cAAc,CAAI;SAAlB,cAAc;AAE3B;;GAEG;AAEH,IAAa,gBAAgB;IAA7B;IAAgC,CAAC;IAAD,uBAAC;AAAD,CAAC,AAAjC,IAAiC;AAApB,gBAAgB;IAD5B,SAAS,CAAC,EAAE,QAAQ,EAAE,oBAAoB,EAAE,CAAC;GACjC,gBAAgB,CAAI;SAApB,gBAAgB;AAE7B;;;GAGG;AAEH,IAAa,gBAAgB;IAA7B;IAAgC,CAAC;IAAD,uBAAC;AAAD,CAAC,AAAjC,IAAiC;AAApB,gBAAgB;IAD5B,SAAS,CAAC,EAAE,QAAQ,EAAE,uCAAuC,EAAE,CAAC;GACpD,gBAAgB,CAAI;SAApB,gBAAgB;AAwB7B,IAAa,SAAS;IAYpB,mBAAoB,QAAiB,EACH,aAAwB;QADtC,aAAQ,GAAR,QAAQ,CAAS;QACH,kBAAa,GAAb,aAAa,CAAW;QAXlD,4BAAuB,GAAe,EAAE,CAAC;QACzC,kBAAa,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC/C,eAAU,GAAG,KAAK,CAAC;QACnB,gBAAW,GAAe,IAAI,CAAC;QAIvC,6EAA6E;QAC7E,gBAAW,GAAqB,SAAS,CAAC;QAKhC,WAAM,GAA4B,IAAI,YAAY,EAAa,CAAC;QAChE,YAAO,GAA4B,IAAI,YAAY,EAAa,CAAC;IAHb,CAAC;IAU/D,+BAAW,GAAX,cAAgB,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;IAEtC,sBAAI,mCAAY;aAAhB;YACE,MAAM,CAAC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,GAAG,IAAI,CAAC,uBAAuB,CAAC;QAC7F,CAAC;;;OAAA;IAED,sBAAsB;IACtB,wBAAI,GAAJ,UAAK,MAAwB;QAC3B,IAAI,CAAC,MAAM,GAAG,oBAAoB,CAAC,MAAM,CAAC,CAAC;QAC3C,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YACpB,MAAM,CAAC,OAAO,CAAC,OAAO,CAAY,IAAI,CAAC,CAAC;QAC1C,CAAC;QACD,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACtC,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAE5B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACrD,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QAC3D,CAAC;QAED,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;QAC7B,MAAM,CAAC,OAAO,CAAC,OAAO,CAAY,IAAI,CAAC,CAAC;IAC1C,CAAC;IAED,uBAAuB;IACvB,yBAAK,GAAL;QACE,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC;QAC5B,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QACxB,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;YAC1B,EAAE,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC;gBAC/B,IAAI,CAAC,qBAAqB,CAAC,WAAW,EAAE,CAAC;YAC3C,CAAC;QACH,CAAC;QAED,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAE5C,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YACf,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YAEnC,gEAAgE;YAChE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC9B,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;YAC9D,CAAC;QACH,CAAC;QACD,MAAM,CAAC,OAAO,CAAC,OAAO,CAAY,IAAI,CAAC,CAAC;IAC1C,CAAC;IAED,sCAAsC;IACtC,gCAAY,GAAZ;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;YAC3B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YAExB,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC/B,CAAC;IACH,CAAC;IAED,gCAAY,GAAZ;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YACpB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACzB,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC1B,CAAC;IACH,CAAC;IAED,kCAAc,GAAd,UAAe,KAAoB;QACjC,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAEhE,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,KAAK,MAAM,IAAI,SAAS;YACvC,CAAC,SAAS,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC;YACjC,SAAS,CAAC,KAAK,EAAE,CAAC;QACpB,CAAC;IACH,CAAC;IAEO,wCAAoB,GAA5B;QAAA,iBAKC;QAJC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC;YAC9B,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC,KAAK,EAAE,CAAC,SAAS,CAAC;gBAC9E,OAAA,KAAI,CAAC,KAAK,EAAE;YAAZ,CAAY,CAAC,CAAC;QAClB,CAAC;IACH,CAAC;IAEO,kCAAc,GAAtB;QACE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACtB,IAAI,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;YAChC,MAAM,CAAC,gBAAgB,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;iBAC/C,MAAM,EAAE;iBACR,kBAAkB,EAAE;iBACpB,gBAAgB,EAAE,CAAC;YACtB,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC;YAE1B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAClD,CAAC;IACH,CAAC;IAEO,yCAAqB,GAA7B;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC;YAC/B,IAAI,CAAC,qBAAqB,CAAC,WAAW,EAAE,CAAC;QAC3C,CAAC;IACH,CAAC;IAEH,gBAAC;AAAD,CAAC,AA9HD,IA8HC;AA/GW;IAAT,MAAM,EAAE;8BAAS,YAAY;yCAA4C;AAChE;IAAT,MAAM,EAAE;8BAAU,YAAY;0CAA4C;AAG/C;IAA3B,SAAS,CAAC,eAAe,CAAC;8BAAU,eAAe;0CAAC;AAErC;IAAf,KAAK,CAAC,OAAO,CAAC;;8CAAqB;AArBzB,SAAS;IAtBrB,SAAS,CAAC;QACT,QAAQ,EAAE,MAAM,CAAC,EAAE;QACnB,QAAQ,EAAE,YAAY;QACtB,WAAW,EAAE,aAAa;QAC1B,SAAS,EAAE,CAAC,YAAY,CAAC;QACzB,IAAI,EAAE;YACJ,UAAU,EAAE,GAAG;YACf,aAAa,EAAE,cAAc;SAC9B;QACD,UAAU,EAAE;YACV,OAAO,CAAC,OAAO,EAAE;gBACf,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,CAAC,CAAC;gBACjD,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,CAAC,CAAC;gBACpD,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE,SAAS,EAAE,UAAU,EAAE,CAAC,CAAC;gBAClD,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,CAAC,CAAC;gBACnD,UAAU,CAAC,cAAc,EAAE,OAAO,CAAC,sCAAsC,CAAC,CAAC;gBAC3E,UAAU,CAAC,aAAa,EAAE,OAAO,CAAC,oCAAoC,CAAC,CAAC;aACzE,CAAC;SACH;QACD,aAAa,EAAE,iBAAiB,CAAC,IAAI;QACrC,QAAQ,EAAE,WAAW;KACtB,CAAC;IAcG,WAAA,QAAQ,EAAE,CAAA,EAAE,WAAA,QAAQ,EAAE,CAAA;qCADK,OAAO;QACY,SAAS;GAb/C,SAAS,CA8HrB;SA9HY,SAAS;AAgItB;;;;GAIG;AACH,8BAA8B,YAA6B;IACzD,MAAM,CAAC,YAAY,CAAC,IAAI,eAAe,EAAE,EAAE,YAAY,CAAC,CAAC;AAC3D,CAAC","sourcesContent":["import {\r\n  Component,\r\n  Output,\r\n  Input,\r\n  EventEmitter,\r\n  Optional,\r\n  SkipSelf,\r\n  ViewChild,\r\n  ViewEncapsulation,\r\n  OnDestroy,\r\n  Directive,\r\n  ViewContainerRef,\r\n  TemplateRef,\r\n} from '@angular/core';\r\nimport {\r\n  style,\r\n  trigger,\r\n  state,\r\n  transition,\r\n  animate,\r\n} from '@angular/animations';\r\nimport {\r\n  ESCAPE,\r\n  Overlay,\r\n  OverlayState,\r\n  OverlayRef,\r\n  TemplatePortalDirective\r\n} from '../core/core';\r\nimport { extendObject } from '../core/util/object-extend';\r\nimport { Subscription } from 'rxjs/Subscription';\r\nimport 'rxjs/add/operator/first';\r\n\r\nexport type DialogVisibility = 'initial' | 'visible' | 'hidden';\r\nexport type DialogRole = 'dialog' | 'alertdialog';\r\n\r\nexport class Md2DialogConfig {\r\n  role?: DialogRole = 'dialog';\r\n  disableClose?: boolean = false;\r\n}\r\n\r\n@Directive({ selector: '[md2DialogPortal]' })\r\nexport class Md2DialogPortal extends TemplatePortalDirective {\r\n  constructor(templateRef: TemplateRef<any>, viewContainerRef: ViewContainerRef) {\r\n    super(templateRef, viewContainerRef);\r\n  }\r\n}\r\n\r\n/**\r\n * Title of a dialog element. Stays fixed to the top of the dialog when scrolling.\r\n */\r\n@Directive({ selector: 'md2-dialog-title' })\r\nexport class Md2DialogTitle { }\r\n\r\n/**\r\n * Scrollable content container of a dialog.\r\n */\r\n@Directive({ selector: 'md2-dialog-content' })\r\nexport class Md2DialogContent { }\r\n\r\n/**\r\n * Container for the bottom action buttons in a dialog.\r\n * Stays fixed to the bottom when scrolling.\r\n */\r\n@Directive({ selector: 'md2-dialog-footer, md2-dialog-actions' })\r\nexport class Md2DialogActions { }\r\n\r\n@Component({\r\n  moduleId: module.id,\r\n  selector: 'md2-dialog',\r\n  templateUrl: 'dialog.html',\r\n  styleUrls: ['dialog.css'],\r\n  host: {\r\n    'tabindex': '0',\r\n    '[attr.role]': 'config?.role',\r\n  },\r\n  animations: [\r\n    trigger('state', [\r\n      state('void', style({ transform: 'scale(0.3)' })),\r\n      state('initial', style({ transform: 'scale(0.3)' })),\r\n      state('visible', style({ transform: 'scale(1)' })),\r\n      state('hidden', style({ transform: 'scale(0.3)' })),\r\n      transition('* => visible', animate('150ms cubic-bezier(0.0, 0.0, 0.2, 1)')),\r\n      transition('* => hidden', animate('150ms cubic-bezier(0.4, 0.0, 1, 1)')),\r\n    ])\r\n  ],\r\n  encapsulation: ViewEncapsulation.None,\r\n  exportAs: 'md2Dialog'\r\n})\r\nexport class Md2Dialog implements OnDestroy {\r\n\r\n  private _openDialogsAtThisLevel: Array<any> = [];\r\n  private _boundKeydown = this._handleKeydown.bind(this);\r\n  private _panelOpen = false;\r\n  private _overlayRef: OverlayRef = null;\r\n  private _backdropSubscription: Subscription;\r\n  config: Md2DialogConfig;\r\n\r\n  /** Property watched by the animation framework to show or hide the dialog */\r\n  _visibility: DialogVisibility = 'initial';\r\n\r\n  constructor(private _overlay: Overlay,\r\n    @Optional() @SkipSelf() private _parentDialog: Md2Dialog) { }\r\n\r\n  @Output() onOpen: EventEmitter<Md2Dialog> = new EventEmitter<Md2Dialog>();\r\n  @Output() onClose: EventEmitter<Md2Dialog> = new EventEmitter<Md2Dialog>();\r\n\r\n  /** The portal to send the dialog content through */\r\n  @ViewChild(Md2DialogPortal) _portal: Md2DialogPortal;\r\n\r\n  @Input('title') dialogTitle: string;\r\n\r\n  ngOnDestroy() { this.destroyPanel(); }\r\n\r\n  get _openDialogs(): Array<any> {\r\n    return this._parentDialog ? this._parentDialog._openDialogs : this._openDialogsAtThisLevel;\r\n  }\r\n\r\n  /** Open the dialog */\r\n  open(config?: Md2DialogConfig): Promise<Md2Dialog> {\r\n    this.config = _applyConfigDefaults(config);\r\n    if (this._panelOpen) {\r\n      return Promise.resolve<Md2Dialog>(this);\r\n    }\r\n    this._createOverlay();\r\n    this._overlayRef.attach(this._portal);\r\n    this._subscribeToBackdrop();\r\n\r\n    if (!this._openDialogs.length && !this._parentDialog) {\r\n      document.addEventListener('keydown', this._boundKeydown);\r\n    }\r\n\r\n    this._openDialogs.push(this);\r\n    this._panelOpen = true;\r\n    this._visibility = 'visible';\r\n    return Promise.resolve<Md2Dialog>(this);\r\n  }\r\n\r\n  /** Close the dialog */\r\n  close(): Promise<Md2Dialog> {\r\n    this._visibility = 'hidden';\r\n    this._panelOpen = false;\r\n    if (this._overlayRef) {\r\n      this._overlayRef.detach();\r\n      if (this._backdropSubscription) {\r\n        this._backdropSubscription.unsubscribe();\r\n      }\r\n    }\r\n\r\n    let index = this._openDialogs.indexOf(this);\r\n\r\n    if (index > -1) {\r\n      this._openDialogs.splice(index, 1);\r\n\r\n      // no open dialogs are left, call next on afterAllClosed Subject\r\n      if (!this._openDialogs.length) {\r\n        document.removeEventListener('keydown', this._boundKeydown);\r\n      }\r\n    }\r\n    return Promise.resolve<Md2Dialog>(this);\r\n  }\r\n\r\n  /** Removes the panel from the DOM. */\r\n  destroyPanel(): void {\r\n    if (this._overlayRef) {\r\n      this._overlayRef.dispose();\r\n      this._overlayRef = null;\r\n\r\n      this._cleanUpSubscriptions();\r\n    }\r\n  }\r\n\r\n  _onPanelDone(): void {\r\n    if (this._panelOpen) {\r\n      this.onOpen.emit(this);\r\n    } else {\r\n      this.onClose.emit(this);\r\n    }\r\n  }\r\n\r\n  _handleKeydown(event: KeyboardEvent) {\r\n    let topDialog = this._openDialogs[this._openDialogs.length - 1];\r\n\r\n    if (event.keyCode === ESCAPE && topDialog &&\r\n      !topDialog.config.disableClose) {\r\n      topDialog.close();\r\n    }\r\n  }\r\n\r\n  private _subscribeToBackdrop(): void {\r\n    if (!this.config.disableClose) {\r\n      this._backdropSubscription = this._overlayRef.backdropClick().first().subscribe(() =>\r\n        this.close());\r\n    }\r\n  }\r\n\r\n  private _createOverlay(): void {\r\n    if (!this._overlayRef) {\r\n      let config = new OverlayState();\r\n      config.positionStrategy = this._overlay.position()\r\n        .global()\r\n        .centerHorizontally()\r\n        .centerVertically();\r\n      config.hasBackdrop = true;\r\n\r\n      this._overlayRef = this._overlay.create(config);\r\n    }\r\n  }\r\n\r\n  private _cleanUpSubscriptions(): void {\r\n    if (this._backdropSubscription) {\r\n      this._backdropSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * Applies default options to the dialog config.\r\n * @param dialogConfig Config to be modified.\r\n * @returns The new configuration object.\r\n */\r\nfunction _applyConfigDefaults(dialogConfig: Md2DialogConfig): Md2DialogConfig {\r\n  return extendObject(new Md2DialogConfig(), dialogConfig);\r\n}\r\n"]}